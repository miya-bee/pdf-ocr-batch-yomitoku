# YomiToku Batch OCR

業務資料や自炊した書籍のスキャンPDFに対し、高精度な日本語OCRエンジン「YomiToku」を用いて一括でテキスト層を付加するGUIアプリケーションです。

最大の特長は、**すでにテキストデータ（OCR情報）を持つPDFを自動で判別して処理をスキップする機能**です。これにより、大量のファイルが混在するフォルダから、未処理のファイルだけを効率的に探し出して補完することができます。

## 主な機能

* **インテリジェントな事前判定**
  `pypdf`を利用してPDF内の文字データを事前に走査します。すでにOCR処理が完了しているファイルや、電子生まれのPDFは自動的にスキップされ、無駄な処理時間を削減します。
* **GPU / CPUの自動判別と柔軟な設定**
  PyTorchによるCUDAの利用可否をチェックし、GPUが使える環境であれば自動的に高速処理を行います。手動でのデバイス指定や、CPU環境向けの軽量モデル（`--lite`）への切り替えも画面上から簡単に行えます。
* **安全なファイル出力**
  元のファイルを上書きしない安全設計です。既存のファイルと同名になる場合は、自動的に連番（`_001`など）を付与して別名保存します（設定で上書きモードに変更も可能）。
* **詳細な実行ログ**
  処理したファイル、スキップされた理由、かかった時間などを記録したCSVログを出力します。長時間のバッチ処理でも、後から確実な結果確認が可能です。

## 動作環境・依存ライブラリ

* Python 3.8 以上
* `pypdf` (テキスト層の事前判定に使用)
* `yomitoku` (メインのOCRエンジン)
* `torch` (GPUを利用する場合に必要)

## インストール方法

1. リポジトリをクローン、またはダウンロードします。
2. 必要なPythonライブラリをインストールします。

```bash
pip install pypdf yomitoku
```

※ GPU（CUDA）を利用する場合は、ご自身の環境に合わせて対応するPyTorchをインストールしてください。

## 使い方

以下のコマンドでアプリケーション（GUI）を起動します。
（※ファイル名は実際のスクリプト名に合わせて変更してください）

```bash
python pdf_ocr_batch_jp_app_gpu_cpu_select_refactored_v10.py
```

### 画面の設定項目

1. **対象フォルダ**: 処理したいPDFが含まれるフォルダを指定します。
2. **サブフォルダも処理する**: チェックを入れると、指定フォルダ内の階層をすべて探索します。
3. **既存の同名出力を上書きする**: 標準ではオフになっており、安全のために連番で別名保存されます。
4. **実行デバイス**: 
   * **自動**: GPUが利用可能かチェックし、可能ならGPU、不可ならCPUで実行します。
   * **CPU / GPU**: 明示的にデバイスを指定します。
5. **軽量モデル**: YomiTokuの軽量モデル（`--lite`）を使用します。CPU処理時に推奨されます。
6. **PDF読取DPI**: スキャン画像の読み取り解像度を指定します。標準は200です。

設定完了後、「実行開始」ボタンを押すと一括処理が始まります。処理中は進捗バーとログテキストで状況がリアルタイムに表示されます。

## ライセンス

This project is licensed under the MIT License.